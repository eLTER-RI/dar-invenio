{#def external_files, files #}


{% if external_files %}
    {#TODO translations#}
    <AccordionField label="External files" accordion_class="detail-section" active="True">
        <div class="ui relaxed divided list">
            {% for file in array(external_files) %}
                <div class="item">
                    <i class="large file middle aligned icon"></i>
                    <div class="content">
                        <a class="header" title="Click to download" href={{ file.sourceUrl }}>{{ file.name }}</a>
                        <div class="description">
                            <div class="ui basic file-format label">File format: {{ file.format }}</div>
                            <a class="ui basic label" onclick="copyToClipboard(this)" title="Click to copy">Checksum: {{ file.md5 }}</a>
                            <a class="ui basic label" title="File size - We dont know the filesize format - To be done">Filesize: {{ file.size }}</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </AccordionField>
{% endif %}

{% if files.enabled %}
    {% set entries = files.entries %}
    {% if entries %}
        {#TODO translations#}
        <AccordionField label="Files" accordion_class="detail-section" active="True">
            <div class="ui relaxed divided list">
                {% for file in array(entries) %}
                    {% if file.status | string == 'pending' %}
                        <div class="item">
                            <i class="large file middle aligned icon"></i>
                            <div class="content">
                                <a class="header"> {{ file.key }}</a>
                                <div class="description">
                                    <i class="spinner loading icon"></i> Waiting for upload
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="item">
                            <i class="large file middle aligned icon"></i>
                            <div class="content">
                                <a class="header" title="Click to download" href={{ file.links.content }}>{{ file.key }}</a>
                                <div class="description">
                                    <div class="ui basic file-format label">Mimetype: {{ file.mimetype }}</div>
                                    <a class="ui basic label" onclick="copyToClipboard(this)" title="Click to copy">Checksum: {{ file.checksum }}</a>
                                    <a class="ui basic label" aria-label="File size">File size: {{ file.size | filesizeformat }}</a>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </AccordionField>
    {% endif %}

{% endif %}


<script>
    function copyToClipboard(element) {
        const textToCopy = element.getAttribute("title");
        const tempInput = document.createElement("input");
        document.body.appendChild(tempInput);
        tempInput.value = textToCopy;
        tempInput.select();
        document.execCommand("copy");
        tempInput.remove();
    }
</script>